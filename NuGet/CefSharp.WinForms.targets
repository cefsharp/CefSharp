<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!--
    These item groups should be in the .props file, unfortunately Nuget 2.8.x doesn't gurantee the
    correct ordering .props imports, which we require as this depends on the cef.redist packages
    exporting an ItemGroup
   -->

  <!-- Copy platform specific libraries to the platform specific folders. -->
  <Choose>
    <When Condition="('$(Platform)' == 'AnyCPU') OR ('$(Platform)' == 'x86') OR ('$(Platform)' == 'Win32')">
      <ItemGroup>
        <None Include="@(CefSharpWinFormsBinaries32)">
          <Link>x86\%(RecursiveDir)%(FileName)%(Extension)</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
          <PublishState>Include</PublishState>
          <Visible>false</Visible>
        </None>
      </ItemGroup>
    </When>
  </Choose>

  <Choose>
    <When Condition="('$(Platform)' == 'AnyCPU') OR ('$(Platform)' == 'x64')">
      <ItemGroup>
        <None Include="@(CefSharpWinFormsBinaries64)">
          <Link>x64\%(RecursiveDir)%(FileName)%(Extension)</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		      <PublishState>Include</PublishState>
		      <Visible>false</Visible>
        </None>
      </ItemGroup>      
    </When>
  </Choose>

  <UsingTask TaskName="TransformXml" AssemblyFile="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v$(VisualStudioVersion)\Web\Microsoft.Web.Publishing.Tasks.dll" />
  <Target Name="CefSharpWinForms_TransformX86Config" Condition="('$(Platform)' == 'AnyCPU') OR ('$(Platform)' == 'x86') OR ('$(Platform)' == 'Win32')" AfterTargets="_CopyAppConfigFile">
    <TransformXml Source="@(AppConfigWithTargetPath->'$(OutDir)%(TargetPath)')" Transform="$(MSBuildThisFileDirectory)app.config.x86.transform" Destination="@(AppConfigWithTargetPath->'$(OutDir)%(TargetPath)')"/>
  </Target>
  <Target Name="CefSharpWinForms_TransformX64Config" Condition="('$(Platform)' == 'AnyCPU') OR ('$(Platform)' == 'x64')" AfterTargets="_CopyAppConfigFile">
    <TransformXml Source="@(AppConfigWithTargetPath->'$(OutDir)%(TargetPath)')" Transform="$(MSBuildThisFileDirectory)app.config.x64.transform" Destination="@(AppConfigWithTargetPath->'$(OutDir)%(TargetPath)')"/>
  </Target>
</Project>
